<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/notes/main.css" />
    <title>A new syntax for the lambda calculus</title>
  </head>

  <body>
    <main><h1 id="A-new-syntax-for-the-lambda-calculus">A new syntax for the lambda calculus</h1><p>“<!-- -->New<!-- -->”<!-- --> is being used very generously here.
This is heavily inspired by JavaScript and Rust:</p><pre><code><span class="comment">// Simple terms</span><span class="line">
</span><span class="keyword">let</span><span class="space"> </span><span class="name">id</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">x</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">x</span><span class="punct">;</span><span class="line">
</span><span class="keyword">let</span><span class="space"> </span><span class="name">zero</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">z</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">z</span><span class="punct">;</span><span class="line">
</span><span class="keyword">let</span><span class="space"> </span><span class="name">suc</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">n</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">z</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">s</span><span class="punct">(</span><span class="name">n</span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">z</span><span class="punct">)</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="comment">// Blocks</span><span class="line">
</span><span class="keyword">let</span><span class="space"> </span><span class="name">forever</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">loop</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">f</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">f</span><span class="punct">(</span><span class="name">f</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="name">loop</span><span class="punct">(</span><span class="name">loop</span><span class="punct">)</span><span class="line">
</span><span class="punct">}</span><span class="punct">;</span></code></pre><p>If we want to write bigger programs (terms), a few more bells and whistles will
be handy:</p><pre><code><span class="keyword">mod</span><span class="space"> </span><span class="name">nat</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">zero</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">z</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">z</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">suc</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">n</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">z</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">s</span><span class="punct">(</span><span class="name">n</span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">z</span><span class="punct">)</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">one</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">suc</span><span class="punct">(</span><span class="name">zero</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">plus</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">m</span><span class="punct">,</span><span class="space"> </span><span class="name">n</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">m</span><span class="punct">(</span><span class="name">suc</span><span class="punct">,</span><span class="space"> </span><span class="name">n</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">times</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">m</span><span class="punct">,</span><span class="space"> </span><span class="name">n</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">m</span><span class="punct">(</span><span class="name">plus</span><span class="punct">(</span><span class="name">n</span><span class="punct">)</span><span class="punct">,</span><span class="space"> </span><span class="name">one</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="punct">}</span><span class="line">

</span><span class="keyword">mod</span><span class="space"> </span><span class="name">pair</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">cons</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">fst</span><span class="punct">,</span><span class="space"> </span><span class="name">snd</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">sel</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">sel</span><span class="punct">(</span><span class="name">fst</span><span class="punct">,</span><span class="space"> </span><span class="name">snd</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">fst</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">p</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">p</span><span class="punct">(</span><span class="punct">(</span><span class="name">f</span><span class="punct">,</span><span class="space"> </span><span class="name">_</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">f</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">snd</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">p</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">p</span><span class="punct">(</span><span class="punct">(</span><span class="name">_</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">s</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">match</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">p</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">handler</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">p</span><span class="punct">(</span><span class="name">handler</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">match2</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">p</span><span class="punct">,</span><span class="space"> </span><span class="name">q</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">handler</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">handler</span><span class="punct">(</span><span class="line">
</span><span class="space">    </span><span class="name">fst</span><span class="punct">(</span><span class="name">p</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="name">snd</span><span class="punct">(</span><span class="name">p</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="name">fst</span><span class="punct">(</span><span class="name">q</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="name">snd</span><span class="punct">(</span><span class="name">q</span><span class="punct">)</span><span class="line">
</span><span class="space">  </span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">swap</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">p</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">p</span><span class="punct">(</span><span class="punct">(</span><span class="name">f</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">cons</span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">f</span><span class="punct">)</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="punct">}</span><span class="line">

</span><span class="comment">// The ring of integers.</span><span class="line">
</span><span class="keyword">mod</span><span class="space"> </span><span class="name">int</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">use</span><span class="space"> </span><span class="keyword">root</span><span class="op">.</span><span class="name">nat</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">use</span><span class="space"> </span><span class="keyword">root</span><span class="op">.</span><span class="name">pair</span><span class="op">.</span><span class="punct">{</span><span class="name">cons</span><span class="punct">,</span><span class="space"> </span><span class="name">fst</span><span class="punct">,</span><span class="space"> </span><span class="name">snd</span><span class="punct">}</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">from_nat</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">n</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">cons</span><span class="punct">(</span><span class="name">n</span><span class="punct">,</span><span class="space"> </span><span class="name">nat</span><span class="op">.</span><span class="name">zero</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// (a - b) + (c - d) = (a + c) - (b + d)</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">plus</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">z</span><span class="punct">,</span><span class="space"> </span><span class="name">w</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">a</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">fst</span><span class="punct">(</span><span class="name">z</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">b</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">snd</span><span class="punct">(</span><span class="name">z</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">c</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">fst</span><span class="punct">(</span><span class="name">w</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">d</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">snd</span><span class="punct">(</span><span class="name">w</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="line">
</span><span class="space">    </span><span class="name">cons</span><span class="punct">(</span><span class="name">nat</span><span class="op">.</span><span class="name">plus</span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">)</span><span class="punct">,</span><span class="space"> </span><span class="name">nat</span><span class="op">.</span><span class="name">plus</span><span class="punct">(</span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="punct">)</span><span class="line">
</span><span class="space">  </span><span class="punct">}</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// (a - b) * (c - d) = (ac + bd) - (ad + bc)</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">times</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">z</span><span class="punct">,</span><span class="space"> </span><span class="name">w</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">a</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">fst</span><span class="punct">(</span><span class="name">z</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">b</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">snd</span><span class="punct">(</span><span class="name">z</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">c</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">fst</span><span class="punct">(</span><span class="name">w</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">d</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">snd</span><span class="punct">(</span><span class="name">w</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">    </span><span class="name">cons</span><span class="punct">(</span><span class="line">
</span><span class="space">      </span><span class="name">nat</span><span class="op">.</span><span class="name">plus</span><span class="punct">(</span><span class="name">nat</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">)</span><span class="punct">,</span><span class="space"> </span><span class="name">nat</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">      </span><span class="name">nat</span><span class="op">.</span><span class="name">plus</span><span class="punct">(</span><span class="name">nat</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="punct">,</span><span class="space"> </span><span class="name">nat</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">)</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="punct">)</span><span class="line">
</span><span class="space">  </span><span class="punct">}</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// Negation: the motivation for integers.</span><span class="line">
</span><span class="space">  </span><span class="comment">// -(a - b) = (b - a)</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">negate</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">pair</span><span class="op">.</span><span class="name">swap</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// Negation makes subtraction possible.</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">sub</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">z</span><span class="punct">,</span><span class="space"> </span><span class="name">w</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">plus</span><span class="punct">(</span><span class="name">z</span><span class="punct">,</span><span class="space"> </span><span class="name">negate</span><span class="punct">(</span><span class="name">w</span><span class="punct">)</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">is_zero</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">z</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="comment">// ...</span><span class="line">
</span><span class="punct">}</span><span class="line">

</span><span class="comment">// The field of rationals.</span><span class="line">
</span><span class="keyword">mod</span><span class="space"> </span><span class="name">rational</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">use</span><span class="space"> </span><span class="keyword">root</span><span class="op">.</span><span class="name">int</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">use</span><span class="space"> </span><span class="keyword">root</span><span class="op">.</span><span class="name">nat</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">use</span><span class="space"> </span><span class="keyword">root</span><span class="op">.</span><span class="name">pair</span><span class="op">.</span><span class="punct">{</span><span class="name">cons</span><span class="punct">,</span><span class="space"> </span><span class="name">fst</span><span class="punct">,</span><span class="space"> </span><span class="name">snd</span><span class="punct">}</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">from_int</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">z</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">cons</span><span class="punct">(</span><span class="name">z</span><span class="punct">,</span><span class="space"> </span><span class="name">int</span><span class="op">.</span><span class="name">from_nat</span><span class="punct">(</span><span class="name">nat</span><span class="op">.</span><span class="name">one</span><span class="punct">)</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// (a / b) + (c / d) = (ad + bc) / bd</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">plus</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">r</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">pair</span><span class="op">.</span><span class="name">match2</span><span class="punct">(</span><span class="name">r</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">    </span><span class="name">cons</span><span class="punct">(</span><span class="line">
</span><span class="space">      </span><span class="name">int</span><span class="op">.</span><span class="name">plus</span><span class="punct">(</span><span class="name">int</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="punct">,</span><span class="space"> </span><span class="name">int</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">)</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">      </span><span class="name">int</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="punct">)</span><span class="line">
</span><span class="space">  </span><span class="punct">}</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// (a / b) * (c / d) = ac / bd</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">times</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">r</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">pair</span><span class="op">.</span><span class="name">match2</span><span class="punct">(</span><span class="name">r</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">    </span><span class="name">cons</span><span class="punct">(</span><span class="line">
</span><span class="space">      </span><span class="name">int</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">c</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">      </span><span class="name">int</span><span class="op">.</span><span class="name">times</span><span class="punct">(</span><span class="name">b</span><span class="punct">,</span><span class="space"> </span><span class="name">d</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="punct">)</span><span class="line">
</span><span class="space">  </span><span class="punct">}</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// Inversion: the motivation for rationals.</span><span class="line">
</span><span class="space">  </span><span class="comment">// 1 / (a / b)</span><span class="line">
</span><span class="space">  </span><span class="comment">//   b == 0    = None</span><span class="line">
</span><span class="space">  </span><span class="comment">//   otherwise = Some(b / a)</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">invert</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">r</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">a</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">fst</span><span class="punct">(</span><span class="name">r</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="keyword">let</span><span class="space"> </span><span class="name">b</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">snd</span><span class="punct">(</span><span class="name">r</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="space">    </span><span class="name">logic</span><span class="op">.</span><span class="name">if</span><span class="punct">(</span><span class="line">
</span><span class="space">      </span><span class="name">int</span><span class="op">.</span><span class="name">is_zero</span><span class="punct">(</span><span class="name">b</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">      </span><span class="name">option</span><span class="op">.</span><span class="name">None</span><span class="punct">,</span><span class="line">
</span><span class="space">      </span><span class="name">option</span><span class="op">.</span><span class="name">Some</span><span class="punct">(</span><span class="name">cons</span><span class="punct">(</span><span class="name">a</span><span class="punct">,</span><span class="space"> </span><span class="name">b</span><span class="punct">)</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="punct">)</span><span class="line">
</span><span class="space">  </span><span class="punct">}</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="comment">// Inversion makes division possible.</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">div</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">r</span><span class="punct">,</span><span class="space"> </span><span class="name">s</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">option</span><span class="op">.</span><span class="name">match</span><span class="punct">(</span><span class="line">
</span><span class="space">    </span><span class="name">invert</span><span class="punct">(</span><span class="name">s</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="name">s1</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">option</span><span class="op">.</span><span class="name">Some</span><span class="punct">(</span><span class="name">times</span><span class="punct">(</span><span class="name">r</span><span class="punct">,</span><span class="space"> </span><span class="name">s1</span><span class="punct">)</span><span class="punct">)</span><span class="punct">,</span><span class="line">
</span><span class="space">    </span><span class="name">option</span><span class="op">.</span><span class="name">None</span><span class="line">
</span><span class="space">  </span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="punct">}</span><span class="line">

</span><span class="comment">// The computable reals.</span><span class="line">
</span><span class="keyword">mod</span><span class="space"> </span><span class="name">real</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="comment">// A real number is an equivalence class of Cauchy sequences of</span><span class="line">
</span><span class="space">  </span><span class="comment">// rationals that converge fast enough?</span><span class="line">
</span><span class="punct">}</span><span class="line">

</span><span class="keyword">mod</span><span class="space"> </span><span class="name">option</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">None</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">n</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">n</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">Some</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">x</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">(</span><span class="name">s</span><span class="punct">,</span><span class="space"> </span><span class="name">n</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">s</span><span class="punct">(</span><span class="name">x</span><span class="punct">)</span><span class="punct">;</span><span class="line">

</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">match</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="name">o</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="punct">(</span><span class="name">if_some</span><span class="punct">,</span><span class="space"> </span><span class="name">if_none</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">o</span><span class="punct">(</span><span class="name">if_some</span><span class="punct">,</span><span class="space"> </span><span class="name">if_none</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="punct">}</span><span class="line">

</span><span class="keyword">mod</span><span class="space"> </span><span class="name">logic</span><span class="space"> </span><span class="punct">{</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">true</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">t</span><span class="punct">,</span><span class="space"> </span><span class="name">f</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">t</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">false</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">t</span><span class="punct">,</span><span class="space"> </span><span class="name">f</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">f</span><span class="punct">;</span><span class="line">
</span><span class="space">  </span><span class="line">
</span><span class="space">  </span><span class="keyword">let</span><span class="space"> </span><span class="name">if</span><span class="space"> </span><span class="op">=</span><span class="space"> </span><span class="punct">(</span><span class="name">test</span><span class="punct">,</span><span class="space"> </span><span class="name">if_true</span><span class="punct">,</span><span class="space"> </span><span class="name">if_false</span><span class="punct">)</span><span class="space"> </span><span class="op">=</span><span class="op">&gt;</span><span class="space"> </span><span class="name">test</span><span class="punct">(</span><span class="name">if_true</span><span class="punct">,</span><span class="space"> </span><span class="name">if_false</span><span class="punct">)</span><span class="punct">;</span><span class="line">
</span><span class="punct">}</span></code></pre></main>
  </body>
</html>